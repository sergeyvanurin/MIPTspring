Turbo Assembler	 Version 4.1	    03/02/20 13:39:32	    Page 1
ramka2.asm



      1	0000			     .model tiny
      2	0000			     .code
      3				     org 100h
      4				     ;-------------------------------------
      5	      =0019		     SCREEN_WIDTH equ 25
      6	      =0050		     SCREEN_LENGTH equ 80
      7	      =000F		     BOX_WIDTH equ 15
      8	      =0028		     BOX_LENGTH	equ 40
      9	      =B800		     VIDEO_SEG equ 0b800h
     10	      =4221		     RED_EXCLAMATION equ 4221h
     11	      =42BA		     VERTICAL_LINE equ 42bah
     12	      =42CD		     HOR_LINE equ 42cdh
     13	      =42C9		     TL_CORNER equ 42c9h
     14	      =42BB		     TR_CORNER equ 42bbh
     15	      =42C8		     BL_CORNER equ 42c8h
     16	      =42BC		     BR_CORNER equ 42bch
     17	      =2221		     GREEN_SHADOW equ 2221h
     18	      =0081		     PSP_COMMAND_LINE equ 81h
     19				     ;-------------------------------------
     20
     21
     22	0100			     start:
     23	0100  BF 0081					     mov di, PSP_COMMAND_LINE				     ;argument adress
     24	0103  B9 000B					     mov cx, 4 + 7					     ;argument count
     25	0106  07*(????)					     symbols dw	7 DUP(?)
     26
     27	0114			     get_dimensions:
     28
     29	0114  E8 010D					     call atoi								    +
     30				     ;
     31	0117  50					     push ax								    +
     32				     ;gets dimensions from PSP
     33	0118  47					     inc di								    +
     34				     ;
     35
     36	0119  E2 F9					     loop get_dimensions
     37
     38	011B  BE 0006					     mov si, 6
     39	011E  B9 0007					     mov cx, 7
     40	0121  5B					     pop bx
     41
     42	0122			     fill_array:
     43	0122  58					     pop ax
     44	0123  D1 E0 D1 E0 D1 E0	D1+			     shl ax, 8
     45	      E0 D1 E0 D1 E0 D1	E0+
     46	      D1 E0
     47	0133  03 C3					     add ax, bx
     48	0135  89 84 0106r				     mov symbols[si], ax
     49	0139  4E					     dec si
     50	013A  E2 E6					     loop fill_array
     51
     52
     53	013C  5B					     pop bx								    +
     54				     ;
     55	013D  58					     pop ax								    +
     56				     ;puts dimensions into designated registers
     57	013E  D1 E3 D1 E3 D1 E3	D1+			     shl bx, 8								    +
Turbo Assembler	 Version 4.1	    03/02/20 13:39:32	    Page 2
ramka2.asm



     58	      E3 D1 E3 D1 E3 D1	E3+  ;dx - X , di - Y, bh - y, bl - x
     59	      D1 E3
     60	014E  0B D8					     or	bx, ax								    +
     61				     ;
     62	0150  5F					     pop di								    +
     63				     ;
     64	0151  5A					     pop dx								    +
     65				     ;
     66
     67	0152  53					     push bx								    +
     68				     ;
     69	0153  52					     push dx								    +
     70				     ;
     71	0154  57					     push di								    +
     72				     ;
     73	0155  D1 EF D1 EF				     shr di, 2								    +
     74				     ;
     75	0159  D1 EA D1 EA				     shr dx, 2								    +
     76				     ;
     77	015D  8B CF					     mov cx, di								    +
     78				     ;
     79	015F  D1 E1 D1 E1 D1 E1	D1+			     shl cx, 8								    +
     80	      E1 D1 E1 D1 E1 D1	E1+  ; zoom arithmetics
     81	      D1 E1
     82	016F  0B CA					     or	cx, dx								    +
     83				     ;
     84	0171  03 D9					     add bx, cx								    +
     85				     ;
     86	0173  D1 E7					     shl di, 1								    +
     87				     ;
     88	0175  D1 E2					     shl dx, 1								    +
     89				     ;
     90	0177  E8 0012					     call draw_box						     ;
     91	017A  5F					     pop di								    +
     92				     ;
     93	017B  5A					     pop dx								    +
     94				     ;
     95	017C  5B					     pop bx								    +
     96				     ;
     97
     98	017D  B4 86					     mov ah, 86h
     99	017F  B9 0002					     mov cx, 2
    100	0182  CD 15					     int 15h
    101
    102
    103	0184  E8 0005					     call draw_box
    104
    105	0187  B8 4C00					     mov ax, 4c00h
    106	018A  CD 21					     int 21h
    107
    108
    109
    110
    111				     ;--------------------------------------------------
    112				     ;dx - X of	a box
    113				     ;di - Y of	a box
    114				     ;bh - y of	a corner
Turbo Assembler	 Version 4.1	    03/02/20 13:39:32	    Page 3
ramka2.asm



    115				     ;bl - x of	a corner
    116				     ;
    117				     ;draws a box from given dimensions	and coordinates
    118				     ;--------------------------------------------------
    119	018C			     draw_box:
    120	018C  A1 010Br					     mov ax, symbols[5]
    121	018F  83 EA 02					     sub dx, 2
    122
    123	0192  E8 0070					     call get_pos
    124
    125	0195  53					     push bx
    126	0196  BB B800					     mov bx, VIDEO_SEG
    127	0199  8E C3					     mov es, bx
    128	019B  5B					     pop bx
    129
    130	019C  26: 8C 77					     mov es:[bx], word ptr symbols[0]
**Error** ramka2.asm(103) Need register	in expression
    131	019F  43					     inc bx
    132	01A0  43					     inc bx
    133
    134	01A1  8B CA					     mov cx, dx
    135	01A3  E8 006E					     call horizontal_line
    136
    137	01A6  26: 8C 77					     mov es:[bx], word ptr symbols[1]
**Error** ramka2.asm(110) Need register	in expression
    138	01A9  43					     inc bx
    139	01AA  43					     inc bx
    140
    141	01AB  81 C3 009C				     add bx, SCREEN_LENGTH * 2 - 4			     ;
    142	01AF  2B DA					     sub bx, dx								    +
    143				     ;	     add bx, (SCREEN_LENGTH - di + 2)*2
    144	01B1  2B DA					     sub bx, dx								    +
    145				     ;
    146
    147
    148	01B3  A1 010Cr					     mov ax, symbols[6]
    149
    150	01B6  8B CF					     mov cx, di
    151
    152	01B8			     next:
    153
    154	01B8  51					     push cx
    155	01B9  26: 8C 77					     mov es:[bx], word ptr symbols[4]
**Error** ramka2.asm(126) Need register	in expression
    156	01BC  43					     inc bx
    157	01BD  43					     inc bx
    158
    159	01BE  8B CA					     mov cx, dx
    160	01C0  E8 0051					     call horizontal_line
    161
    162	01C3  26: 8C 77					     mov es:[bx], word ptr symbols[4]
**Error** ramka2.asm(133) Need register	in expression
    163	01C6  43					     inc bx
    164	01C7  43					     inc bx
    165
    166	01C8  26: C7 07	2221				     mov es:[bx], GREEN_SHADOW
    167
Turbo Assembler	 Version 4.1	    03/02/20 13:39:32	    Page 4
ramka2.asm



    168	01CD  81 C3 009C				     add bx, SCREEN_LENGTH * 2 - 4			     ;
    169	01D1  2B DA					     sub bx, dx								    +
    170				     ;	     add bx, (SCREEN_LENGTH - di - 2)*2
    171	01D3  2B DA					     sub bx, dx								    +
    172				     ;
    173
    174	01D5  59					     pop cx
    175
    176	01D6  E2 E0					     loop next
    177
    178
    179
    180	01D8  26: 8C 77					     mov es:[bx], word ptr symbols[2]
**Error** ramka2.asm(149) Need register	in expression
    181	01DB  43					     inc bx
    182	01DC  43					     inc bx
    183
    184	01DD  8B CA					     mov cx, dx
    185	01DF  A1 010Br					     mov ax, symbols[5]
    186	01E2  E8 002F					     call horizontal_line
    187
    188	01E5  26: 8C 77					     mov es:[bx], symbols[3]
**Error** ramka2.asm(157) Need register	in expression
    189	01E8  43					     inc bx
    190	01E9  43					     inc bx
    191
    192	01EA  26: C7 07	2221				     mov es:[bx], GREEN_SHADOW
    193	01EF  43					     inc bx
    194	01F0  43					     inc bx
    195
    196
    197	01F1  81 C3 009C				     add bx, SCREEN_LENGTH * 2 - 4			     ;
    198	01F5  2B DA					     sub bx, dx								    +
    199				     ;	     add bx, (SCREEN_LENGTH - di - 2)*2
    200	01F7  2B DA					     sub bx, dx
    201
    202	01F9  8B CA					     mov cx, dx
    203	01FB  83 C1 02					     add cx, 2
    204	01FE  B8 2221					     mov ax, GREEN_SHADOW
    205	0201  E8 0010					     call horizontal_line
    206
    207
    208
    209	0204  C3					     ret
    210				     ;---------------------------------------
    211				     ;calculates position from coordinates
    212				     ;
    213				     ;bh - height
    214				     ;bl - width
    215				     ;---------------------------------------
    216
    217	0205			     get_pos:
    218
    219	0205  50						     push ax
    220
    221	0206  B0 50						     mov al, 80d
    222	0208  F6 E7						     mul bh
Turbo Assembler	 Version 4.1	    03/02/20 13:39:32	    Page 5
ramka2.asm



    223	020A  32 FF						     xor bh, bh
    224	020C  03 C3						     add ax, bx
    225	020E  D1 E0						     shl ax, 1
    226
    227	0210  8B D8						     mov bx, ax
    228
    229	0212  58						     pop ax
    230
    231	0213  C3						     ret
    232
    233				     ;---------------------------------
    234				     ;draws line with given symbol from	given point
    235				     ;
    236				     ;input:
    237				     ;ax - symbol
    238				     ;cx - line	length
    239				     ;bx - starting point
    240				     ;---------------------------------
    241	0214			     horizontal_line:
    242	0214  57						     push di
    243	0215  53						     push bx
    244	0216  BB B800						     mov bx, VIDEO_SEG
    245	0219  8E C3						     mov es, bx
    246	021B  5B						     pop bx
    247
    248	021C  8B FB						     mov di, bx
    249	021E  F3> AB						     rep stosw
    250	0220  8B DF						     mov bx, di
    251
    252	0222  5F						     pop di
    253
    254	0223  C3						     ret
    255
    256
    257
    258				     ;-----------------------------
    259				     ;transforms ASCII to int from given adress(seperated by comma)
    260				     ;input:
    261				     ;di - adress
    262				     ;output:
    263				     ;ax - result
    264				     ;-----------------------------
    265	0224			     atoi:
    266	0224  51						     push cx
    267	0225  33 C0						     xor ax, ax
    268	0227  B7 00						     mov bh, 00
    269	0229  B1 0A						     mov cl, 10d
    270	022B			     transform:
    271	022B  8A 5D 01						     mov bl, byte [di]
    272	022E  80 FB 2C						     cmp bl, ','
    273	0231  74 0F						     je	finish
    274
    275	0233  80 FB 0D						     cmp bl, 0Dh
    276	0236  74 0A						     je	finish
    277
    278	0238  80 EB 30						     sub bl, '0'
    279	023B  F6 E9						     imul cl
Turbo Assembler	 Version 4.1	    03/02/20 13:39:32	    Page 6
ramka2.asm



    280	023D  03 C3						     add ax, bx
    281
    282	023F  47						     inc di
    283	0240  EB E9						     jmp transform
    284	0242			     finish:
    285	0242  59						     pop cx
    286	0243  C3						     ret
    287
    288				     end start
Turbo Assembler	 Version 4.1	    03/02/20 13:39:32	    Page 7
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "03/02/20"
??FILENAME			  Text	 "ramka2  "
??TIME				  Text	 "13:39:32"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 RAMKA2
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
ATOI				  Near	 DGROUP:0224
BL_CORNER			  Number 42C8
BOX_LENGTH			  Number 0028
BOX_WIDTH			  Number 000F
BR_CORNER			  Number 42BC
DRAW_BOX			  Near	 DGROUP:018C
FILL_ARRAY			  Near	 DGROUP:0122
FINISH				  Near	 DGROUP:0242
GET_DIMENSIONS			  Near	 DGROUP:0114
GET_POS				  Near	 DGROUP:0205
GREEN_SHADOW			  Number 2221
HORIZONTAL_LINE			  Near	 DGROUP:0214
HOR_LINE			  Number 42CD
NEXT				  Near	 DGROUP:01B8
PSP_COMMAND_LINE		  Number 0081
RED_EXCLAMATION			  Number 4221
SCREEN_LENGTH			  Number 0050
SCREEN_WIDTH			  Number 0019
START				  Near	 DGROUP:0100
SYMBOLS				  Word	 DGROUP:0106
TL_CORNER			  Number 42C9
TRANSFORM			  Near	 DGROUP:022B
TR_CORNER			  Number 42BB
VERTICAL_LINE			  Number 42BA
VIDEO_SEG			  Number B800

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  0244 Word	  Public  CODE
Turbo Assembler	 Version 4.1	    03/02/20 13:39:32	    Page 8
Error Summary



**Error** ramka2.asm(103) Need register	in expression
**Error** ramka2.asm(110) Need register	in expression
**Error** ramka2.asm(126) Need register	in expression
**Error** ramka2.asm(133) Need register	in expression
**Error** ramka2.asm(149) Need register	in expression
**Error** ramka2.asm(157) Need register	in expression
